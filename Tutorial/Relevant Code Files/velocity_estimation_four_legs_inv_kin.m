clear all;
close all;
A=importdata('REOUTPUT.TXT');
[m,n]=size(A);
% A=A.data;
% I1=find(A(:,1)==1);
% A1=A(I1,2:11);
A7=A(find(A(:,1)==1),2:6); %these are for the HR leg
A8=A(find(A(:,1)==2),2:6);
A5=A(find(A(:,1)==3),2:6); %these are for the HL leg
A6=A(find(A(:,1)==4),2:6);
A3=A(find(A(:,1)==5),2:6); %these are for the FR leg
A4=A(find(A(:,1)==6),2:6);
A1=A(find(A(:,1)==7),2:6); %these are for the FL leg
A2=A(find(A(:,1)==8),2:6);
[m,n]=size(A1);

time1=A1(:,1);
time2=A2(:,1);
time3=A3(:,1);
time4=A4(:,1);
time5=A5(:,1);
time6=A6(:,1);
time7=A7(:,1);
time8=A8(:,1);

position1=A1(:,2); %angle of encoder
position2=A2(:,2); %angle of encoder
position3=A3(:,2); %angle of encoder
position4=A4(:,2); %angle of encoder
position5=A5(:,2); %angle of encoder
position6=A6(:,2); %angle of encoder
position7=A7(:,2); %angle of encoder
position8=A8(:,2); %angle of encoder

fpga_vel1=A1(:,3);%velocity of encoder rad/s
fpga_vel2=A2(:,3);%velocity of encoder rad/s
fpga_vel3=A3(:,3);%velocity of encoder rad/s
fpga_vel4=A4(:,3);%velocity of encoder rad/s
fpga_vel5=A5(:,3);%velocity of encoder rad/s
fpga_vel6=A6(:,3);%velocity of encoder rad/s
fpga_vel7=A7(:,3);%velocity of encoder rad/s
fpga_vel8=A8(:,3);%velocity of encoder rad/s

duty1=A1(:,4);%duty
duty2=A2(:,4);%duty
duty3=A3(:,4);%duty
duty4=A4(:,4);%duty
duty5=A5(:,4);%duty
duty6=A6(:,4);%duty
duty7=A7(:,4);%duty
duty8=A8(:,4);%duty

des_pos1=A1(:,5);%desired position
des_pos2=A2(:,5);%desired position
des_pos3=A3(:,5);%desired position
des_pos4=A4(:,5);%desired position
des_pos5=A5(:,5);%desired position
des_pos6=A6(:,5);%desired position
des_pos7=A7(:,5);%desired position
des_pos8=A8(:,5);%desired position

des_vel1=zeros(size(des_pos1,1),1);%desired velocity
des_vel2=zeros(size(des_pos2,1),1);%desired velocity
des_vel3=zeros(size(des_pos3,1),1);%desired velocity
des_vel4=zeros(size(des_pos4,1),1);%desired velocity
des_vel5=zeros(size(des_pos5,1),1);%desired velocity
des_vel6=zeros(size(des_pos6,1),1);%desired velocity
des_vel7=zeros(size(des_pos7,1),1);%desired velocity
des_vel8=zeros(size(des_pos8,1),1);%desired velocity

pos_sat1=30.*ones(size(des_pos1,1),1);%positive saturation limit of duty
pos_sat2=30.*ones(size(des_pos2,1),1);%positive saturation limit of duty
pos_sat3=30.*ones(size(des_pos3,1),1);%positive saturation limit of duty
pos_sat4=30.*ones(size(des_pos4,1),1);%positive saturation limit of duty
pos_sat5=30.*ones(size(des_pos5,1),1);%positive saturation limit of duty
pos_sat6=30.*ones(size(des_pos6,1),1);%positive saturation limit of duty
pos_sat7=30.*ones(size(des_pos7,1),1);%positive saturation limit of duty
pos_sat8=30.*ones(size(des_pos8,1),1);%positive saturation limit of duty

neg_sat1=-30.*ones(size(des_pos1,1),1);%negative saturation limit of duty
neg_sat2=-30.*ones(size(des_pos2,1),1);%negative saturation limit of duty
neg_sat3=-30.*ones(size(des_pos3,1),1);%negative saturation limit of duty
neg_sat4=-30.*ones(size(des_pos4,1),1);%negative saturation limit of duty
neg_sat5=-30.*ones(size(des_pos5,1),1);%negative saturation limit of duty
neg_sat6=-30.*ones(size(des_pos6,1),1);%negative saturation limit of duty
neg_sat7=-30.*ones(size(des_pos7,1),1);%negative saturation limit of duty
neg_sat8=-30.*ones(size(des_pos8,1),1);%negative saturation limit of duty

velocity=zeros(m,1);
const=ones(m,1);
total=zeros(m,3);

lv1=0.250;
lv2=0.350;
%%plot of first leg's end effector 
x_des_plot=lv1.*sin(deg2rad(des_pos1))+lv2.*sin(deg2rad(des_pos2));
y_des_plot=lv1.*cos(deg2rad(des_pos1))+lv2.*cos(deg2rad(des_pos2));
x_e_plot=lv1.*sin(deg2rad(position1))+lv2.*sin(deg2rad(position2));
y_e_plot=lv1.*cos(deg2rad(position1))+lv2.*cos(deg2rad(position2));
t1_1=find(time1==5);
t1_2=find(time1==10);
t2_1=find(time2==5);
t2_2=find(time2==10);

f=figure;
subplot(2,2,1);
plot(x_des_plot(t1_1:t1_2,1),y_des_plot(t2_1:t2_2,1))
hold on;
plot(x_e_plot(t1_1:t1_2,1),y_e_plot(t2_1:t2_2,1))
title('FL End Effector in Steady State');
ax = gca
% ax.XLim = [-0.031 0.031];
% ax.YLim = [0.539 0.575];
ax.YDir = 'reverse'
legend('Desired Position',"Actual Position",'Location','south')
legend('boxoff')
xlabel('x axis')
ylabel('y axis')
%%end of plot of first leg's end effector 

%%plot of second leg's end effector 
x_des_plot=lv1.*sin(deg2rad(des_pos3))+lv2.*sin(deg2rad(des_pos4));
y_des_plot=lv1.*cos(deg2rad(des_pos3))+lv2.*cos(deg2rad(des_pos4));
x_e_plot=lv1.*sin(deg2rad(position3))+lv2.*sin(deg2rad(position4));
y_e_plot=lv1.*cos(deg2rad(position3))+lv2.*cos(deg2rad(position4));
t1_1=find(time3==5);
t1_2=find(time3==10);
t2_1=find(time4==5);
t2_2=find(time4==10);

subplot(2,2,2);
plot(x_des_plot(t1_1:t1_2,1),y_des_plot(t2_1:t2_2,1))
hold on;
plot(x_e_plot(t1_1:t1_2,1),y_e_plot(t2_1:t2_2,1))
title('FR End Effector in Steady State');
ax = gca
% ax.XLim = [-0.031 0.031];
% ax.YLim = [0.539 0.575];
ax.YDir = 'reverse'
legend('Desired Position',"Actual Position",'Location','south')
legend('boxoff')
xlabel('x axis')
ylabel('y axis')
%%end of plot of second leg's end effector 

%%plot of third leg's end effector 
x_des_plot=lv1.*sin(deg2rad(des_pos5))+lv2.*sin(deg2rad(des_pos6));
y_des_plot=lv1.*cos(deg2rad(des_pos5))+lv2.*cos(deg2rad(des_pos6));
x_e_plot=lv1.*sin(deg2rad(position5))+lv2.*sin(deg2rad(position6));
y_e_plot=lv1.*cos(deg2rad(position5))+lv2.*cos(deg2rad(position6));
t1_1=find(time5==5);
t1_2=find(time5==10);
t2_1=find(time6==5);
t2_2=find(time6==10);

subplot(2,2,3);
plot(x_des_plot(t1_1:t1_2,1),y_des_plot(t2_1:t2_2,1))
hold on;
plot(x_e_plot(t1_1:t1_2,1),y_e_plot(t2_1:t2_2,1))
title('HL End Effector in Steady State');
ax = gca
% ax.XLim = [-0.031 0.031];
% ax.YLim = [0.539 0.575];
ax.YDir = 'reverse'
legend('Desired Position',"Actual Position",'Location','south')
legend('boxoff')
xlabel('x axis')
ylabel('y axis')
%%end of plot of third leg's end effector

%%plot of fourth leg's end effector 
x_des_plot=lv1.*sin(deg2rad(des_pos7))+lv2.*sin(deg2rad(des_pos8));
y_des_plot=lv1.*cos(deg2rad(des_pos7))+lv2.*cos(deg2rad(des_pos8));
x_e_plot=lv1.*sin(deg2rad(position7))+lv2.*sin(deg2rad(position8));
y_e_plot=lv1.*cos(deg2rad(position7))+lv2.*cos(deg2rad(position8));
t1_1=find(time7==5);
t1_2=find(time7==10);
t2_1=find(time8==5);
t2_2=find(time8==10);

subplot(2,2,4);
plot(x_des_plot(t1_1:t1_2,1),y_des_plot(t2_1:t2_2,1))
hold on;
plot(x_e_plot(t1_1:t1_2,1),y_e_plot(t2_1:t2_2,1))
title('HR End Effector in Steady State');
ax = gca
% ax.XLim = [-0.031 0.031];
% ax.YLim = [0.539 0.575];
ax.YDir = 'reverse'
legend('Desired Position',"Actual Position",'Location','south')
legend('boxoff')
xlabel('x axis')
ylabel('y axis')
%%end of plot of fourth leg's end effector

%%start of plot of Response of First Leg's Hip Angle
f=figure;
subplot(2,4,1);
p11=plot(time1(:,1),position1(:,1));
title("Response of FL's Hip Angle")
xlabel('Time(s)')
ylabel('Angle[deg]')
ax = gca
% ax.XLim = [0 600];
% ax.YLim = [-180 180];
hold on
p12=plot(time1(:,1),des_pos1(:,1));
legend("Motor's Position",'Desired Position')
hold off
%%start of plot of Response of First Leg's Hip Angle
%--------
%%start of plot of Response of First Leg's Knee Angle
subplot(2,4,5);
p13=plot(time2(:,1),position2(:,1));
title("Response of FL's Knee Angle")
xlabel('Time(s)')
ylabel('Angle[deg]')
ax = gca
% ax.XLim = [0 600];
% ax.YLim = [305 330];
hold on
p14=plot(time2(:,1),des_pos2(:,1));
legend("Motor's Position",'Desired Position')
hold off
%%end of plot of Response of First Leg's Knee Angle
%--------
%%start of plot of Response of Second Leg's Hip Angle
subplot(2,4,2);
p15=plot(time3(:,1),position3(:,1));
title("Response of FR's Hip Angle")
xlabel('Time(s)')
ylabel('Angle[deg]')
ax = gca
% ax.XLim = [0 600];
% ax.YLim = [305 330];
hold on
p16=plot(time3(:,1),des_pos3(:,1));
legend("Motor's Position",'Desired Position')
hold off
%%end of plot of Response of Second Leg's Hip Angle
%--------
%%start of plot of Response of Second Leg's Knee Angle
subplot(2,4,6);
p17=plot(time4(:,1),position4(:,1));
title("Response of FR's Knee Angle")
xlabel('Time(s)')
ylabel('Angle[deg]')
ax = gca
% ax.XLim = [0 600];
% ax.YLim = [305 330];
hold on
p18=plot(time4(:,1),des_pos4(:,1));
legend("Motor's Position",'Desired Position')
hold off
%%end of plot of Response of Second Leg's Knee Angle
%-------
%%start of plot of Response of Third Leg's Hip Angle
subplot(2,4,3);
p19=plot(time5(:,1),position5(:,1));
title("Response of HL's Hip Angle")
xlabel('Time(s)')
ylabel('Angle[deg]')
ax = gca
% ax.XLim = [0 600];
% ax.YLim = [-180 180];
hold on
p110=plot(time5(:,1),des_pos5(:,1));
legend("Motor's Position",'Desired Position')
hold off
%%end of plot of Response of Third Leg's Hip Angle
%--------
%%start of plot of Response of Third Leg's Knee Angle
subplot(2,4,7);
p111=plot(time6(:,1),position6(:,1));
title("Response of HL's Knee Angle")
xlabel('Time(s)')
ylabel('Angle[deg]')
ax = gca
% ax.XLim = [0 600];
% ax.YLim = [-180 180];
hold on
p112=plot(time6(:,1),des_pos6(:,1));
legend("Motor's Position",'Desired Position')
hold off
%%end of plot of Response of Third Leg's Knee Angle
%--------
%%start of plot of Response of Fourth Leg's Hip Angle
subplot(2,4,4);
p113=plot(time7(:,1),position7(:,1));
title("Response of HR's Hip Angle") %this is the first leg?
xlabel('Time(s)')
ylabel('Angle[deg]')
ax = gca
% ax.XLim = [0 600];
% ax.YLim = [-180 180];
hold on
p114=plot(time7(:,1),des_pos7(:,1));
legend("Motor's Position",'Desired Position')
hold off
%%end of plot of Response of Fourth Leg's Hip Angle
%--------
%%start of plot of Response of Fourth Leg's Knee Angle
subplot(2,4,8);
p114=plot(time8(:,1),position8(:,1));
title("Response of HR's Knee Angle")
xlabel('Time(s)')
ylabel('Angle[deg]')
ax = gca
% ax.XLim = [0 600];
% ax.YLim = [-180 180];
hold on
p115=plot(time8(:,1),des_pos8(:,1));
legend("Motor's Position",'Desired Position')
hold off
%%end of plot of Response of Fourth Leg's Knee Angle
%--------
%%%%%%

%%%%%%
%%start of plot of Response of First Leg's Hip Velocity
f1=figure;
subplot(2,4,1);
p21=plot(time1(:,1),fpga_vel1(:,1));
title("Response of FL's Hip Velocity")
xlabel('Time(s)')
ylabel('Velocity[rad/s]')
ax = gca
% ax.XLim = [0 600];
% ax.YLim = [-20 20];
hold on
p22=plot(time1(:,1),des_vel1(:,1));
legend("Motor's Velocity",'Desired Velocity')
hold off
%%end of plot of Response of First Leg's Hip Velocity

%%start of plot of Response of First Leg's Knee Velocity
subplot(2,4,5);
p23=plot(time2(:,1),fpga_vel2(:,1));
title("Response of FL's Knee Velocity")
xlabel('Time(s)')
ylabel('Velocity[rad/s]')
ax = gca
% ax.XLim = [0 600];
% ax.YLim = [-20 20];
hold on
p24=plot(time2(:,1),des_vel2(:,1));
legend("Motor's Velocity",'Desired Velocity')
hold off
%%end of plot of Response of First Leg's Knee Velocity

%%start of plot of Response of Second Leg's Hip Velocity
subplot(2,4,2);
p25=plot(time3(:,1),fpga_vel3(:,1));
title("Response of FR's Hip Velocity")
xlabel('Time(s)')
ylabel('Velocity[rad/s]')
ax = gca
% ax.XLim = [0 600];
% ax.YLim = [-20 20];
hold on
p26=plot(time3(:,1),des_vel3(:,1));
legend("Motor's Velocity",'Desired Velocity')
hold off
%%end of plot of Response of Second Leg's Hip Velocity

%%start of plot of Response of Second Leg's Knee Velocity
subplot(2,4,6);
p27=plot(time4(:,1),fpga_vel4(:,1));
title("Response of FR's Knee Velocity")
xlabel('Time(s)')
ylabel('Velocity[rad/s]')
ax = gca
% ax.XLim = [0 600];
% ax.YLim = [-20 20];
hold on
p28=plot(time4(:,1),des_vel4(:,1));
legend("Motor's Velocity",'Desired Velocity')
hold off
%%end of plot of Response of Second Leg's Knee Velocity
%%------
%between forward and hinder
%%------
%%start of plot of Response of Third Leg's Hip Velocity
subplot(2,4,3);
p29=plot(time5(:,1),fpga_vel5(:,1));
title("Response of HL's Hip Velocity")
xlabel('Time(s)')
ylabel('Velocity[rad/s]')
ax = gca
% ax.XLim = [0 600];
% ax.YLim = [-20 20];
hold on
p210=plot(time5(:,1),des_vel5(:,1));
legend("Motor's Velocity",'Desired Velocity')
hold off
%%start of plot of Response of Third Leg's Hip Velocity

%%start of plot of Response of Third Leg's Knee Velocity
subplot(2,4,7);
p211=plot(time6(:,1),fpga_vel6(:,1));
title("Response of HL's Knee Velocity")
xlabel('Time(s)')
ylabel('Velocity[rad/s]')
ax = gca
% ax.XLim = [0 600];
% ax.YLim = [-20 20];
hold on
p212=plot(time6(:,1),des_vel6(:,1));
legend("Motor's Velocity",'Desired Velocity')
hold off
%%end of plot of Response of Third Leg's Knee Velocity

%%start of plot of Response of Fourth Leg's Hip Velocity
subplot(2,4,4);
p213=plot(time7(:,1),fpga_vel7(:,1));
title("Response of HR's Hip Velocity")
xlabel('Time(s)')
ylabel('Velocity[rad/s]')
ax = gca
% ax.XLim = [0 600];
% ax.YLim = [-20 20];
hold on
p214=plot(time7(:,1),des_vel7(:,1));
legend("Motor's Velocity",'Desired Velocity')
hold off
%%start of plot of Response of Fourth Leg's Hip Velocity

%%start of plot of Response of Fourth Leg's Knee Velocity
subplot(2,4,8);
p215=plot(time8(:,1),fpga_vel8(:,1));
title("Response of HR's Knee Velocity")
xlabel('Time(s)')
ylabel('Velocity[rad/s]')
ax = gca
% ax.XLim = [0 600];
% ax.YLim = [-20 20];
hold on
p216=plot(time8(:,1),des_vel8(:,1));
legend("Motor's Velocity",'Desired Velocity')
hold off
%%end of plot of Response of Fourth Leg's Knee Velocity
%%%%%%%%

%%%%%%%%
f2=figure;
subplot(2,4,1);
p31=plot(time1(:,1),duty1(:,1));
title("PWM Command of FL's Hip")
xlabel('Time(s)')
ylabel('PWM Command [%]')
ax = gca
% ax.XLim = [0 600];
ax.YLim = [-40 40];
hold on
p32=plot(time1(:,1),pos_sat1(:,1));
p33=plot(time1(:,1),neg_sat1(:,1)); 
legend('Duty Cycle','Positive Saturation Limit','Negative Saturation Limit')
hold off
subplot(2,4,5);
p34=plot(time2(:,1),duty2(:,1));
title("PWM Command of FL's Knee")
xlabel('Time(s)')
ylabel('PWM Command [%]')
ax = gca
% ax.XLim = [0 600];
ax.YLim = [-40 40];
hold on
p35=plot(time2(:,1),pos_sat2(:,1));
p36=plot(time2(:,1),neg_sat2(:,1)); 
legend('Duty Cycle','Positive Saturation Limit','Negative Saturation Limit')
hold off
subplot(2,4,2);
p37=plot(time3(:,1),duty3(:,1));
title("PWM Command of FR's Hip")
xlabel('Time(s)')
ylabel('PWM Command [%]')
ax = gca
% ax.XLim = [0 600];
ax.YLim = [-40 40];
hold on
p38=plot(time3(:,1),pos_sat3(:,1));
p39=plot(time3(:,1),neg_sat3(:,1)); 
legend('Duty Cycle','Positive Saturation Limit','Negative Saturation Limit')
hold off
subplot(2,4,6);
p310=plot(time4(:,1),duty4(:,1));
title("PWM Command of FR's Knee")
xlabel('Time(s)')
ylabel('PWM Command [%]')
ax = gca
% ax.XLim = [0 600];
ax.YLim = [-40 40];
hold on
p311=plot(time4(:,1),pos_sat4(:,1));
p312=plot(time4(:,1),neg_sat4(:,1)); 
legend('Duty Cycle','Positive Saturation Limit','Negative Saturation Limit')
hold off
%%-----
%forward and hinder
%%-----
subplot(2,4,3);
p313=plot(time5(:,1),duty5(:,1));
title("PWM Command of HL's Hip")
xlabel('Time(s)')
ylabel('PWM Command [%]')
ax = gca
% ax.XLim = [0 600];
ax.YLim = [-40 40];
hold on
p314=plot(time5(:,1),pos_sat5(:,1));
p315=plot(time5(:,1),neg_sat5(:,1)); 
legend('Duty Cycle','Positive Saturation Limit','Negative Saturation Limit')
hold off
subplot(2,4,7);
p316=plot(time6(:,1),duty6(:,1));
title("PWM Command of HL's Knee")
xlabel('Time(s)')
ylabel('PWM Command [%]')
ax = gca
% ax.XLim = [0 600];
ax.YLim = [-40 40];
hold on
p317=plot(time6(:,1),pos_sat6(:,1));
p318=plot(time6(:,1),neg_sat6(:,1)); 
legend('Duty Cycle','Positive Saturation Limit','Negative Saturation Limit')
hold off
subplot(2,4,4);
p319=plot(time7(:,1),duty7(:,1));
title("PWM Command of HR's Hip")
xlabel('Time(s)')
ylabel('PWM Command [%]')
ax = gca
% ax.XLim = [0 600];
ax.YLim = [-40 40];
hold on
p320=plot(time7(:,1),pos_sat7(:,1));
p321=plot(time7(:,1),neg_sat7(:,1)); 
legend('Duty Cycle','Positive Saturation Limit','Negative Saturation Limit')
hold off
subplot(2,4,8);
p322=plot(time8(:,1),duty8(:,1));
title("PWM Command of HR's Knee")
xlabel('Time(s)')
ylabel('PWM Command [%]')
ax = gca
% ax.XLim = [0 600];
ax.YLim = [-40 40];
hold on
p323=plot(time8(:,1),pos_sat8(:,1));
p324=plot(time8(:,1),neg_sat8(:,1)); 
legend('Duty Cycle','Positive Saturation Limit','Negative Saturation Limit')
hold off

